<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aurax Registration & Login Flow Tester</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background: linear-gradient(135deg, #1e1e2e 0%, #2d2d44 100%);
        color: #ffffff;
        min-height: 100vh;
      }

      .container {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 20px;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      h1 {
        text-align: center;
        color: #60a5fa;
        margin-bottom: 30px;
        text-shadow: 0 0 10px rgba(96, 165, 250, 0.3);
      }

      h2 {
        color: #fbbf24;
        border-bottom: 2px solid rgba(251, 191, 36, 0.3);
        padding-bottom: 10px;
      }

      .test-section {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 30px;
      }

      .form-group {
        margin-bottom: 15px;
      }

      label {
        display: block;
        margin-bottom: 5px;
        color: #d1d5db;
        font-weight: 500;
      }

      input,
      select {
        width: 100%;
        padding: 12px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        background: rgba(0, 0, 0, 0.3);
        color: #ffffff;
        font-size: 14px;
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: #60a5fa;
        box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.2);
      }

      button {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        font-size: 14px;
        transition: all 0.3s ease;
        margin: 5px;
        min-width: 140px;
      }

      .btn-primary {
        background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
      }

      .btn-success {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
      }

      .btn-warning {
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        color: white;
      }

      .btn-danger {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        color: white;
      }

      .result {
        margin-top: 15px;
        padding: 15px;
        border-radius: 8px;
        font-family: "Courier New", monospace;
        font-size: 13px;
        white-space: pre-wrap;
        max-height: 200px;
        overflow-y: auto;
      }

      .success {
        background: rgba(16, 185, 129, 0.2);
        border: 1px solid rgba(16, 185, 129, 0.3);
        color: #6ee7b7;
      }

      .error {
        background: rgba(239, 68, 68, 0.2);
        border: 1px solid rgba(239, 68, 68, 0.3);
        color: #fca5a5;
      }

      .info {
        background: rgba(59, 130, 246, 0.2);
        border: 1px solid rgba(59, 130, 246, 0.3);
        color: #93c5fd;
      }

      .status-indicator {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 8px;
      }

      .status-success {
        background: #10b981;
      }
      .status-error {
        background: #ef4444;
      }
      .status-pending {
        background: #f59e0b;
      }

      .test-flow {
        background: rgba(0, 0, 0, 0.2);
        border-radius: 10px;
        padding: 20px;
        margin: 20px 0;
      }

      .step {
        display: flex;
        align-items: center;
        margin: 10px 0;
        padding: 10px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
      }

      .step-number {
        background: #60a5fa;
        color: white;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 12px;
        font-weight: bold;
        font-size: 12px;
      }

      .navigation-links {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }

      .nav-link {
        display: block;
        padding: 15px;
        background: rgba(96, 165, 250, 0.1);
        border: 1px solid rgba(96, 165, 250, 0.3);
        border-radius: 8px;
        color: #60a5fa;
        text-decoration: none;
        text-align: center;
        transition: all 0.3s ease;
      }

      .nav-link:hover {
        background: rgba(96, 165, 250, 0.2);
        transform: translateY(-2px);
      }
    </style>
  </head>
  <body>
    <h1>ğŸ§ª Aurax Registration & Login Flow Comprehensive Tester</h1>

    <div class="container">
      <h2>ğŸ“‹ Database Cleanup Status</h2>
      <div class="result success">
        âœ… User Database Cleanup Completed Removed Accounts: â€¢
        sourabh.chandanshive@gmail.com â€¢ saurabhchandan5498@gmail.com â€¢
        saurabhchandan544@gmail.com â€¢ saurabhchandan05@gmail.com â€¢
        saurabhchandan2911@gmail.com âœ… 4 users successfully removed from
        database âœ… Skip Verification button completely removed from UI âœ… All
        accounts are now available for fresh registration testing
      </div>
    </div>

    <div class="container">
      <h2>ğŸŒ Application URLs</h2>
      <div class="navigation-links">
        <a href="http://localhost:3001/signup" class="nav-link" target="_blank">
          ğŸ“ General Signup
        </a>
        <a
          href="http://localhost:3001/signup?role=creator"
          class="nav-link"
          target="_blank"
        >
          ğŸ¨ Creator Signup
        </a>
        <a
          href="http://localhost:3001/signup?role=brand"
          class="nav-link"
          target="_blank"
        >
          ğŸ¢ Brand Signup
        </a>
        <a
          href="http://localhost:3001/creator/login"
          class="nav-link"
          target="_blank"
        >
          ğŸ¨ Creator Login
        </a>
        <a
          href="http://localhost:3001/brand/login"
          class="nav-link"
          target="_blank"
        >
          ğŸ¢ Brand Login
        </a>
      </div>
    </div>

    <div class="container">
      <h2>ğŸ”„ Complete Registration Flow Test</h2>

      <div class="test-section">
        <div>
          <h3>ğŸ“ Registration Test</h3>
          <div class="form-group">
            <label for="testEmail">Test Email:</label>
            <input
              type="email"
              id="testEmail"
              value="sourabh.chandanshive@gmail.com"
              placeholder="test@example.com"
            />
          </div>
          <div class="form-group">
            <label for="testUsername">Username:</label>
            <input
              type="text"
              id="testUsername"
              value="testuser"
              placeholder="username"
            />
          </div>
          <div class="form-group">
            <label for="testPassword">Password:</label>
            <input
              type="password"
              id="testPassword"
              value="testpassword123"
              placeholder="password"
            />
          </div>
          <div class="form-group">
            <label for="testRole">Role:</label>
            <select id="testRole">
              <option value="creator">Creator</option>
              <option value="brand">Brand</option>
            </select>
          </div>
          <button class="btn-primary" onclick="testRegistration()">
            ğŸš€ Test Registration
          </button>
          <button class="btn-warning" onclick="testResendVerification()">
            ğŸ“§ Test Resend Code
          </button>
        </div>

        <div>
          <h3>âœ… Verification Test</h3>
          <div class="form-group">
            <label for="verifyEmail">Email:</label>
            <input
              type="email"
              id="verifyEmail"
              value="sourabh.chandanshive@gmail.com"
              placeholder="email@example.com"
            />
          </div>
          <div class="form-group">
            <label for="verifyCode">Verification Code:</label>
            <input type="text" id="verifyCode" placeholder="6-digit code" />
          </div>
          <button class="btn-success" onclick="testEmailVerification()">
            âœ… Test Verification
          </button>
        </div>
      </div>

      <div class="test-section">
        <div>
          <h3>ğŸ” Login Test</h3>
          <div class="form-group">
            <label for="loginEmail">Email:</label>
            <input
              type="email"
              id="loginEmail"
              value="sourabh.chandanshive@gmail.com"
              placeholder="email@example.com"
            />
          </div>
          <div class="form-group">
            <label for="loginPassword">Password:</label>
            <input
              type="password"
              id="loginPassword"
              value="testpassword123"
              placeholder="password"
            />
          </div>
          <button class="btn-primary" onclick="testLogin()">
            ğŸ” Test Login
          </button>
        </div>

        <div>
          <h3>ğŸ§¹ Database Operations</h3>
          <button class="btn-danger" onclick="cleanupTestUser()">
            ğŸ—‘ï¸ Remove Test User
          </button>
          <button class="btn-warning" onclick="checkUserExists()">
            ğŸ” Check User Exists
          </button>
          <button class="btn-primary" onclick="testBackendHealth()">
            ğŸ’“ Test Backend Health
          </button>
        </div>
      </div>

      <div id="testResults" class="result info" style="display: none"></div>
    </div>

    <div class="container">
      <h2>ğŸ“‹ Testing Workflow</h2>
      <div class="test-flow">
        <div class="step">
          <div class="step-number">1</div>
          <div>
            Register a new account using the form above - verify success message
            appears
          </div>
        </div>
        <div class="step">
          <div class="step-number">2</div>
          <div>
            Check your email (including spam folder) for verification code
          </div>
        </div>
        <div class="step">
          <div class="step-number">3</div>
          <div>
            Enter verification code to complete registration - should redirect
            to dashboard
          </div>
        </div>
        <div class="step">
          <div class="step-number">4</div>
          <div>
            Test login with the same credentials - should work after
            verification
          </div>
        </div>
        <div class="step">
          <div class="step-number">5</div>
          <div>Verify "Skip Verification" button is NOT visible anywhere</div>
        </div>
        <div class="step">
          <div class="step-number">6</div>
          <div>
            Test login redirect URLs are role-appropriate (creator vs brand)
          </div>
        </div>
      </div>
    </div>

    <script>
      const API_BASE = "http://localhost:5002/api";

      function showResult(message, type = "info") {
        const resultDiv = document.getElementById("testResults");
        resultDiv.className = `result ${type}`;
        resultDiv.textContent = message;
        resultDiv.style.display = "block";
        console.log(`[${type.toUpperCase()}]`, message);
      }

      async function testRegistration() {
        const email = document.getElementById("testEmail").value;
        const username = document.getElementById("testUsername").value;
        const password = document.getElementById("testPassword").value;
        const role = document.getElementById("testRole").value;

        if (!email || !username || !password) {
          showResult("âŒ Please fill in all registration fields", "error");
          return;
        }

        try {
          showResult("ğŸš€ Testing registration...", "info");

          const response = await fetch(`${API_BASE}/register`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, username, password, role }),
          });

          const data = await response.json();

          if (response.ok && data.status === "success") {
            showResult(
              `âœ… Registration successful!\n\nResponse: ${JSON.stringify(
                data,
                null,
                2
              )}\n\nğŸ‰ Check your email for verification code`,
              "success"
            );
          } else {
            showResult(
              `âŒ Registration failed:\n\n${JSON.stringify(data, null, 2)}`,
              "error"
            );
          }
        } catch (error) {
          showResult(`âŒ Registration error: ${error.message}`, "error");
        }
      }

      async function testEmailVerification() {
        const email = document.getElementById("verifyEmail").value;
        const code = document.getElementById("verifyCode").value;

        if (!email || !code) {
          showResult("âŒ Please provide email and verification code", "error");
          return;
        }

        try {
          showResult("âœ… Testing email verification...", "info");

          const response = await fetch(`${API_BASE}/auth/verify-email`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, code }),
          });

          const data = await response.json();

          if (response.ok && data.success) {
            showResult(
              `âœ… Email verification successful!\n\nResponse: ${JSON.stringify(
                data,
                null,
                2
              )}\n\nğŸ‰ You can now login with these credentials`,
              "success"
            );
          } else {
            showResult(
              `âŒ Email verification failed:\n\n${JSON.stringify(
                data,
                null,
                2
              )}`,
              "error"
            );
          }
        } catch (error) {
          showResult(`âŒ Verification error: ${error.message}`, "error");
        }
      }

      async function testResendVerification() {
        const email = document.getElementById("testEmail").value;

        if (!email) {
          showResult("âŒ Please provide email address", "error");
          return;
        }

        try {
          showResult("ğŸ“§ Testing resend verification...", "info");

          const response = await fetch(`${API_BASE}/auth/resend-verification`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email }),
          });

          const data = await response.json();

          if (response.ok && data.success) {
            showResult(
              `âœ… Resend verification successful!\n\nResponse: ${JSON.stringify(
                data,
                null,
                2
              )}\n\nğŸ“§ Check your email again`,
              "success"
            );
          } else {
            showResult(
              `âŒ Resend verification failed:\n\n${JSON.stringify(
                data,
                null,
                2
              )}`,
              "error"
            );
          }
        } catch (error) {
          showResult(`âŒ Resend error: ${error.message}`, "error");
        }
      }

      async function testLogin() {
        const email = document.getElementById("loginEmail").value;
        const password = document.getElementById("loginPassword").value;

        if (!email || !password) {
          showResult("âŒ Please provide email and password", "error");
          return;
        }

        try {
          showResult("ğŸ” Testing login...", "info");

          const response = await fetch(`${API_BASE}/login`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ emailOrPhone: email, password }),
          });

          const data = await response.json();

          if (response.ok && data.token) {
            showResult(
              `âœ… Login successful!\n\nResponse: ${JSON.stringify(
                data,
                null,
                2
              )}\n\nğŸ‰ Token received - authentication working!`,
              "success"
            );
          } else {
            showResult(
              `âŒ Login failed:\n\n${JSON.stringify(data, null, 2)}`,
              "error"
            );
          }
        } catch (error) {
          showResult(`âŒ Login error: ${error.message}`, "error");
        }
      }

      async function cleanupTestUser() {
        const email = document.getElementById("testEmail").value;

        if (!email) {
          showResult("âŒ Please provide email address", "error");
          return;
        }

        try {
          showResult("ğŸ—‘ï¸ Cleaning up test user...", "info");

          const response = await fetch(`${API_BASE}/admin/cleanup-user`, {
            method: "DELETE",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email }),
          });

          const data = await response.json();
          showResult(
            `ğŸ—‘ï¸ Cleanup result:\n\n${JSON.stringify(data, null, 2)}`,
            response.ok ? "success" : "error"
          );
        } catch (error) {
          showResult(`âŒ Cleanup error: ${error.message}`, "error");
        }
      }

      async function checkUserExists() {
        const email = document.getElementById("testEmail").value;

        if (!email) {
          showResult("âŒ Please provide email address", "error");
          return;
        }

        try {
          showResult("ğŸ” Checking if user exists...", "info");

          const response = await fetch(
            `${API_BASE}/admin/check-user?email=${encodeURIComponent(email)}`
          );
          const data = await response.json();

          showResult(
            `ğŸ” User check result:\n\n${JSON.stringify(data, null, 2)}`,
            "info"
          );
        } catch (error) {
          showResult(`âŒ Check error: ${error.message}`, "error");
        }
      }

      async function testBackendHealth() {
        try {
          showResult("ğŸ’“ Testing backend health...", "info");

          const response = await fetch(`${API_BASE}/test`);
          const data = await response.json();

          if (response.ok) {
            showResult(
              `âœ… Backend is healthy!\n\nResponse: ${JSON.stringify(
                data,
                null,
                2
              )}`,
              "success"
            );
          } else {
            showResult(
              `âš ï¸ Backend health check failed:\n\n${JSON.stringify(
                data,
                null,
                2
              )}`,
              "error"
            );
          }
        } catch (error) {
          showResult(`âŒ Backend health error: ${error.message}`, "error");
        }
      }

      // Auto-test backend health on page load
      window.addEventListener("load", () => {
        testBackendHealth();
      });
    </script>
  </body>
</html>
